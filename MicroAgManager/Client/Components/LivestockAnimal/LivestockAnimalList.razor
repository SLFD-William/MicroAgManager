@using Domain.Models
@using FrontEnd.Components.LivestockBreed
@inherits DataComponent

@if (app != null)
{
    @if (_editAnimal is not null || !Items.Any())
    {
        <CascadingValue Value="_editAnimal">
            <LivestockAnimalEditor @ref="_animalEditor" Submitted="@AnimalUpdated" Cancelled="@EditCancelled" showUpdateCancelButtons="true"></LivestockAnimalEditor>
        </CascadingValue>
    }
    else
    {
        <TableTemplate @ref="_listComponent" PageSize="0" TItem="LivestockAnimalRow"
            Items="@Items"
            MultiSelect="@Multiselect"
            Selectable="@Selectable"
            OnSelectionChange="@TableItemSelected"
            CanDelete="@CanDelete"
            RowDetailsShowing="@app.RowDetailsShowing["LivestockAnimalList"]"
            NewItemName="Animal"
            AddItemClicked="@(()=> EditAnimal(0))">
            <ColumnContent>
                <Column TableItem="LivestockAnimalRow" Field="@(x => x.Id)" Title="ControlColumn">
                    <Template Context="e">
                        <button type="button" onclick="@(()=> _listComponent.ToggleRowDetailsShowing(e))">Show Details</button>
                        @if (CanDelete)
                        {
                            <button type="button">Delete</button>
                        }
                    </Template>
                </Column>
                <Column TableItem="LivestockAnimalRow" Field="@(x => x.Name)" Sortable="true" Filterable="true" UseInSuperSearch="true" >
                    <Template Context="e">
                        <button type="button" onclick="@(()=> EditAnimal(e.Id))">@e.Name</button>
                    </Template>
                </Column>
                <Column TableItem="LivestockAnimalRow" Field="@(x => x.GroupName)" Title="Group Name" Sortable="true" Filterable="true" UseInSuperSearch="true" />
                <Column TableItem="LivestockAnimalRow" Field="@(x => x.ParentFemaleName)" Title="Female Ancestor Title" Sortable="true" Filterable="true" UseInSuperSearch="true" />
                <Column TableItem="LivestockAnimalRow" Field="@(x => x.ParentMaleName)" Title="Male Ancestor Title" Sortable="true" Filterable="true" UseInSuperSearch="true" />
                <Column TableItem="LivestockAnimalRow" Field="@(x => x.Care)" Title="Management Style" Sortable="true" Filterable="true" UseInSuperSearch="true" />
                <Column TableItem="LivestockAnimalRow" Field="@(x => x.BreedsCount)" Sortable="true" Filterable="true" UseInSuperSearch="true" Title="Number of Breeds" />
                <Column TableItem="LivestockAnimalRow" Field="@(x => x.StatusesCount)" Sortable="true" Filterable="true" UseInSuperSearch="true" Title="Number of Statuses" />
                <Column TableItem="LivestockAnimalRow" Field="@(x => x.FeedsCount)" Sortable="true" Filterable="true" UseInSuperSearch="true" Title="Number of Feeds" />
            </ColumnContent>
            <TableRowDetailTemplate>
                <CascadingValue Value="@(context as LivestockAnimalRow)">
                    <LivestockBreedList Items="@app.dbContext.LivestockBreeds.Where(s=> s.LivestockAnimalId == context.Id)"></LivestockBreedList>"
                </CascadingValue>
            </TableRowDetailTemplate>

            
        </TableTemplate>
    }
}