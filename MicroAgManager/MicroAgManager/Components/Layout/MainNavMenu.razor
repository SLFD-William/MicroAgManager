@implements IDisposable

@inject NavigationManager NavigationManager

<input type="checkbox" title="Navigation menu" class="navbar-toggler" />

    <nav class="MainNavMenu" onclick="document.querySelector('.navbar-toggler').click()">
        <ul>
            <li>
                <a class="brand" href="">MicroAgManager</a>
            </li>
        <li class="spanner"></li>
            <AuthorizeView>
                <Authorized>
                    <li>
                        <NavLink href="/Home" Match="NavLinkMatch.Prefix">
                            @* <span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> *@ Home
                        </NavLink>
                    </li>
                    
                    <li>
                        <NavLink href="/Farm" Match="NavLinkMatch.Prefix">
                            @* <span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> *@ Farm
                        </NavLink>
                    </li>
                <li>
                    <NavLink href="/Livestock" Match="NavLinkMatch.Prefix">
                        @* <span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> *@ Livestock
                    </NavLink>
                </li>
                    <li>
                        <NavLink href="Account/Manage">
                            @* <span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> *@ @context.User.Identity?.Name
                        </NavLink>
                    </li>
                    <li>
                        <form action="Account/Logout" method="post">
                            <AntiforgeryToken />
                            <input type="hidden" name="ReturnUrl" value="@currentUrl" />
                            <button type="submit">
                                @* <span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> *@ Logout
                            </button>
                        </form>
                    </li>
                </Authorized>
                <NotAuthorized>
                    <li>
                    <NavLink href="@(NavigationManager.GetUriWithQueryParameters("/Account/Register", new Dictionary<string, object?> { ["ReturnUrl"] = "/Home" }))">
                            @* <span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> *@ Register
                        </NavLink>
                    </li>
                    <li>
                    <NavLink href="@(NavigationManager.GetUriWithQueryParameters("/Account/Login", new Dictionary<string, object?> { ["ReturnUrl"] = "/Home" }))">
                            @* <span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> *@ Login
                        </NavLink>
                    </li>
                </NotAuthorized>
            </AuthorizeView>
        </ul>
    </nav>


@code {
    private string? currentUrl;

    protected override void OnInitialized()
    {
        currentUrl = NavigationManager.ToBaseRelativePath(NavigationManager.Uri);
        NavigationManager.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        currentUrl = NavigationManager.ToBaseRelativePath(e.Location);
        StateHasChanged();
    }

    public void Dispose()
    {
        NavigationManager.LocationChanged -= OnLocationChanged;
    }
}

